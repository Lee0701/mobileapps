paths:
  # from routes/feed/announcements.js
  /{domain}/v1/feed/announcements:
    get:
      tags:
        - Feed
      summary: Get announcements for the Explore feed in the mobile apps.
      description: |
        Gets announcements for display in the official Wikipedia iOS and Android apps.
        This is usually used to show announcements for surveys or fundraising.
      parameters:
        - $ref: '#/components/parameters/domainParam'
      responses:
        200:
          description: Announcements for the given Wiki
          content:
            'application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Announcements/0.3.0"':
              schema:
                $ref: '#/components/schemas/announcements'
        default:
          $ref: "#/components/responses/problem"
      x-amples:
        - summary: Retrieve announcements
          value:
            response:
              status: 200
              headers:
                content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Announcements/0.3.0"
                cache-control: public, max-age=7200, s-maxage=14400
                vary: /.+/
                etag: /^"[^/"]+/[^/"]+"$/
                access-control-allow-origin: '*'
                access-control-allow-headers: accept, x-requested-with, content-type
                content-security-policy: default-src
                x-content-security-policy: default-src
                x-frame-options: SAMEORIGIN
components:
  schemas:
    announcements:
      type: object
      properties:
        announce:
          type: array
          description: list of active announcements for this wiki
          items:
            $ref: '#/components/schemas/announcement'
      required:
        - announce

    availability:
      type: object
      properties:
        todays_featured_article:
          type: array
          description: domains for wikis with this feature enabled, or [ '*.<project>.org' ] for all wikis in a project
          items:
            type: string
        most_read:
          type: array
          description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
          items:
            type: string
        picture_of_the_day:
          type: array
          description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
          items:
            type: string
        in_the_news:
          type: array
          description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
          items:
            type: string
        on_this_day:
          type: array
          description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
          items:
            type: string
      required: [ todays_featured_article, most_read, picture_of_the_day, in_the_news, on_this_day ]
      additionalProperties: false

    announcement:
      type: object
      properties:
        id:
          type: string
          description: Unique ID of the announcement
        type:
          type: string
          description: The announcement type
          enum:
            - survey
            - fundraising
            - announcement
        start_time:
          type: string
          description: The ISO 8601 date to begin showing the announcement.
        end_time:
          type: string
          description: The ISO 8601 date to stop showing the announcement.
        platforms:
          type: array
          description: |
            An array of platforms on which to display the announcement.
          items:
            type: string
            enum:
              - iOSApp
              - iOSAppV2
              - AndroidApp
              - AndroidAppV2
        text:
          type: string
          description: The text of the announcement
        image:
          type: string
          description: \[DEPRECATED\] The URL of the image for the announcement (Android only)
        image_url:
          type: string
          description: The URL of the image for the announcement
        action:
          $ref: '#/components/schemas/action'
        caption_HTML:
          type: string
          description: HTML to display below the announcement. Usually a privacy statment and link to a policy
        countries:
          type: array
          description: |
            An array of country codes in which to display the announcement. Clients should derive
            the country from 'GeoIP' portion of the Set-Cookie header.
          items:
            type: string
        min_version:
          type: string
          description: minimum app version code for which to show the announcement
        max_version:
          type: string
          description: maximum app version code for which to show the announcement
        beta:
          type: boolean
          description: |
            (AndroidAppV2 only) Optional boolean flag controlling the release builds for which the announcement should be shown.
            Set to true if the announcement should be shown only in pre-production builds (beta, alpha, dev).
            Set to false if the announcement should be shown only in release builds.
            If not defined, the announcement will be shown for all builds.
        logged_in:
          type: boolean
          description: |
            (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on the user login state.
            Set to true if the announcement should be shown only if the user is logged in.
            Set to false if the announcement should be shown only if the user is NOT logged in.
            If not defined, the announcement will be shown regardless of the user's login state.
        reading_list_sync_enabled:
          type: boolean
          description: |
            (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on whether the user
            has enabled reading list syncing.
            Set to true if the announcement should be shown only if the user has enabled reading list syncing.
            Set to false if the announcement should be shown only if the user has NOT enabled reading list syncing.
            If not defined, the announcement will be shown regardless of whether the user has enabled reading list syncing.
        negative_text:
          type: string
          description: |
            (AndroidAppV2 only) text to show on a "negative" button on the announcement. If absent, the button is not shown
        image_height:
          type: integer
          description: |
            (AndroidAppV2 only) height, in device-independent pixels, of the image portion of the announcement card
      required:
        - id
        - type
        - start_time
        - end_time
        - platforms
        - text
        - countries
        - action

    action:
      type: object
      properties:
        title:
          type: string
          description: The title to display on the button that performs the action
        url:
          type: string
          description: The URL to navigate to when the button is pressed
      required:
        - title
        - url
