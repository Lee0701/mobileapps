
definitions:
  # A https://tools.ietf.org/html/draft-nottingham-http-problem
  problem:
    required:
      - type
    properties:
      status:
        type: integer
      type:
        type: string
      title:
        type: string
      detail:
        type: string
      method:
        type: string
      uri:
        type: string

  article_title:
    type: object
    properties:
      title:
        type: string
        description: An article title
    required:
      - title

  article_summary_merge_link:
    type: object
    properties:
      $merge:
        type: array
        description: One-element array containing the link to the RESTBase summary for the article
        items:
          type: string
    required:
      - $merge

  image_props:
    type: object
    properties:
      source:
        type: string
        description: URI
      width:
        type: integer
        minimum: 0
        description: width (px)
      height:
        type: integer
        minimum: 0
        description: height (px)
      mime:
        type: string
        description: MIME type
    required:
      - source
      - width
      - height
    additionalProperties: false

  # see also RB v1/common_schemas.yaml
  summary:
    type: object
    properties:
      type:
        type: string
        description: Type of page summary
        enum:
          - standard
          - disambiguation
          - no-extract
          - mainpage
      title:
        type: string
        description: The page title
      displaytitle:
        type: string
        description: The page title how it should be shown to the user
      namespace:
        type: object
        properties:
          id:
            type: integer
            description: the numeric ID for the page's namespace (https://www.mediawiki.org/wiki/Manual:Namespace)
          text:
            type: string
            description: localized text name for the MediaWiki namespace
        required: [ id, text ]
        additionalProperties: false
      wikibase_item:
        type: string
        description: the Wikibase item ID for the associated Wikidata entity (if any)
      titles:
        $ref: '#/definitions/titles_set'
      pageid:
        type: integer
        description: The page ID
      revision:
        type: string
        description: The revision of the page when the summary was produced
      tid:
        type: string
        description: The timeuuid associated with the underlying HTML content
      extract:
        type: string
        description: First several sentences of an article in plain text
      extract_html:
        type: string
        description: First several sentences of an article in simple HTML format
      thumbnail:
        $ref: '#/definitions/image_props'
      originalimage:
        $ref: '#/definitions/image_props'
      lang:
        type: string
        description: The page language code
        example: en
      dir:
        type: string
        description: The page language direction code
        enum:
          - ltr
          - rtl
      timestamp:
        type: string
        format: date-time
        description: The time when the page was last editted in the [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) format
        example: '1970-01-01T00:00:00.000Z'
      description:
        type: string
        description: short description for the page
        example: American poet
      content_urls:
        type: object
        properties:
          desktop:
            $ref: '#/definitions/content_urls'
          mobile:
            $ref: '#/definitions/content_urls'
      api_urls:
        $ref: '#/definitions/api_urls'
      coordinates:
        type: object
        description: The coordinates of the item
        properties:
          lat:
            type: number
            description: The latitude
          lon:
            type: number
            description: The longitude
        required: [ 'lat', 'lon' ]
    required:
      - type
      - title
      - displaytitle
      - pageid
      - lang
      - dir
      - revision
      - timestamp
      - content_urls
      - api_urls
      - extract
      - extract_html

  dated_pageview:
    type: object
    properties:
      date:
        type: string
        description: ISO 8601 timestamp of pageviews recorded
      views:
        type: integer
        description: Number of views on date
    required:
      - date
      - views
    additionalProperties: false

  mostread_article:
    type: object
    properties:
      $merge:
        type: array
        description: One-element array containing the link to the RESTBase summary for the article
        items:
          type: string
      views:
        type: integer
        description: Number of views on the requested day
      view_history:
        type: array
        items:
          $ref: '#/definitions/dated_pageview'
      rank:
        type: integer
        description: Position in the list of most viewed articles
    required:
      - $merge
      - views
      - rank

  mostread:
    type: object
    properties:
      date:
        type: string
        description: The date which the data correspond to
      articles:
        type: array
        description: Array of most popular articles
        items:
          $ref: '#/definitions/mostread_article'
    required:
      - date
      - articles

  onthisdayList:
    type: array
    items:
      type: object
      properties:
        text:
          type: string
          description: Short description of the event
        year:
          type: integer
          description: The year this event occurred
        pages:
          type: array
          description: List of pages related to the event
          items:
            $ref: '#/definitions/article_summary_merge_link'
      required:
        - text
        - pages

  onthisdayResponse:
    type: object
    description: Lists of events which happened on the provided day and month
    properties:
      births:
        $ref: '#/definitions/onthisdayList'
      deaths:
        $ref: '#/definitions/onthisdayList'
      events:
        $ref: '#/definitions/onthisdayList'
      holidays:
        $ref: '#/definitions/onthisdayList'
      selected:
        $ref: '#/definitions/onthisdayList'
    additionalProperties: false

  news_item:
    type: object
    properties:
      story:
        type: string
        description: A cover story for the news item
      links:
        type: array
        description: |
          A collection of pages mentioned in the headline. The first page is the headline topic.
        items:
          $ref: '#/definitions/article_summary_merge_link'
    required:
      - story
      - links

  news:
    type: array
    items:
      $ref: '#/definitions/news_item'

  random:
    type: object
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/article_title'
    required:
      - items

  extmetadata_property:
    properties:
      html:
        type: string
        description: HTML of the description
      text:
        type: string
        description: Plain text of the description
      lang:
        type: string
        description: Language code of the description (if available)
    required:
      - html
      - text

  image:
    type: object
    properties:
      title:
        type: string
        description: Image title
      thumbnail:
        $ref: '#/definitions/image_props'
      image:
        $ref: '#/definitions/image_props'
      description:
        $ref: '#/definitions/extmetadata_property'
      file_page:
        type: string
        description: Full URL to the file page for the item on Wikimedia Commons
      artist:
        type: object
        description: structured info about the author of the media item
        properties:
          html:
            type: string
            description: HTML string describing the artist
          name:
            type: string
            description: the plain text artist name, if available
          user_page:
            type: string
            description: Wikimedia Commons user page for the artist, if available
        required:
          - html
      credit:
        $ref: '#/definitions/extmetadata_property'
      license:
        type: object
        description: license under which the media item is available on Wikimedia Commons
        properties:
          type:
            type: string
            description: license type
          url:
            type: string
            description: URL describing the terms and conditions of the license, if any
        required:
          - type
      wb_entity_id:
        type: string
        description: Commons Wikibase ID, if the file is on Wikimedia Commons
      structured:
        type: object
        description: structured image metadata from Structured Data on Commons (SDC)
        properties:
          captions:
            type: object
            description: caption (label) values by language
        required: [captions]
    required:
      - title
      - thumbnail
      - image
      - license
      - structured

  announcements:
    type: object
    properties:
      announce:
        type: array
        description: list of active announcements for this wiki
        items:
          $ref: '#/definitions/announcement'
    required:
      - announce

  availability:
    type: object
    properties:
      todays_featured_article:
        type: array
        description: domains for wikis with this feature enabled, or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      most_read:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      picture_of_the_day:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      in_the_news:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      on_this_day:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
    required: [ todays_featured_article, most_read, picture_of_the_day, in_the_news, on_this_day ]
    additionalProperties: false

  announcement:
    type: object
    properties:
      id:
        type: string
        description: Unique ID of the announcement
      type:
        type: string
        description: The announcement type
        enum:
          - survey
          - fundraising
          - announcement
      start_time:
        type: string
        description: The ISO 8601 date to begin showing the announcement.
      end_time:
        type: string
        description: The ISO 8601 date to stop showing the announcement.
      platforms:
        type: array
        description: |
          An array of platforms on which to display the announcement.
        items:
          type: string
          enum:
            - iOSApp
            - iOSAppV2
            - AndroidApp
            - AndroidAppV2
      text:
        type: string
        description: The text of the announcement
      image:
        type: string
        description: \[DEPRECATED\] The URL of the image for the announcement (Android only)
      image_url:
        type: string
        description: The URL of the image for the announcement
      action:
        $ref: '#/definitions/action'
      caption_HTML:
        type: string
        description: HTML to display below the announcement. Usually a privacy statment and link to a policy
      countries:
        type: array
        description: |
          An array of country codes in which to display the announcement. Clients should derive
          the country from 'GeoIP' portion of the Set-Cookie header.
        items:
          type: string
      min_version:
        type: string
        description: minimum app version code for which to show the announcement
      max_version:
        type: string
        description: maximum app version code for which to show the announcement
      beta:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling the release builds for which the announcement should be shown.
          Set to true if the announcement should be shown only in pre-production builds (beta, alpha, dev).
          Set to false if the announcement should be shown only in release builds.
          If not defined, the announcement will be shown for all builds.
      logged_in:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on the user login state.
          Set to true if the announcement should be shown only if the user is logged in.
          Set to false if the announcement should be shown only if the user is NOT logged in.
          If not defined, the announcement will be shown regardless of the user's login state.
      reading_list_sync_enabled:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on whether the user
          has enabled reading list syncing.
          Set to true if the announcement should be shown only if the user has enabled reading list syncing.
          Set to false if the announcement should be shown only if the user has NOT enabled reading list syncing.
          If not defined, the announcement will be shown regardless of whether the user has enabled reading list syncing.
      negative_text:
        type: string
        description: |
          (AndroidAppV2 only) text to show on a "negative" button on the announcement. If absent, the button is not shown
      image_height:
        type: integer
        description: |
          (AndroidAppV2 only) height, in device-independent pixels, of the image portion of the announcement card
    required:
      - id
      - type
      - start_time
      - end_time
      - platforms
      - text
      - countries
      - action

  metadata:
    type: object
    properties:
      revision:
        type: string
        description: revision ID for the page
      tid:
        type: string
        description: time UUID for the page/revision
      hatnotes:
        type: array
        description: the hatnotes on the page, with html and plaintext representations provided for each
        items:
          $ref: '#/definitions/hatnote_or_page_issue'
      issues:
        type: array
        description: the page issues on the page, with html and plaintext representations provided for each
        items:
          $ref: '#/definitions/hatnote_or_page_issue'
      toc:
        type: object
        description: a table of contents for the page, in structured form
        properties:
          title:
            type: string
            description: the TOC title string for the wiki as reported by siteinfo
          entries:
            type: array
            description: section info for the TOC in structured form
            items:
              $ref: '#/definitions/toc_entry'
        required: [ title, entries ]
        additionalProperties: false
      language_links:
        type: array
        description: list of titles and language codes for the article topic on other language Wikipedias
        items:
          type: object
          description: titles and language codes for the article topic on another language Wikipedia
          properties:
            lang:
              type: string
              description: language code
            titles:
              type: object
              description: titles dictionary
              properties:
                canonical:
                  type: string
                  description: canonical title
                normalized:
                  type: string
                  description: normalized title
              required:
                - canonical
                - normalized
            summary_url:
              type: string
              description: link to REST API summary
          required:
            - lang
            - titles
            - summary_url
      categories:
        type: array
        description: categories the page belongs to
        items:
          $ref: '#/definitions/category'
      protection:
        type: object
        description: info on page edit and move rights
        items:
          $ref: '#/definitions/protection'
      description_source:
        type: string
        enum:
          - central
          - local
        description: Whether the description is defined locally or comes from Wikidata.  May be 'central' or 'local'.
    required: [ revision, tid, protection ]
    additionalProperties: false

  hatnote_or_page_issue:
    type: object
    properties:
      section:
        type: integer
        description: section ID containing the hatnote or page issue
      html:
        type: string
        description: the hatnote or page issue HTML
    required: [ section, html ]
    additionalProperties: false

  toc_entry:
    type: object
    properties:
      level:
        type: integer
        description: the depth of the heading in the TOC hierarchy
      section:
        type: integer
        description: the position of the section in the order of appearance of all sections on the page
      number:
        type: string
        description: a numeric representation of the section's position in the page hierarhcy (e.g., '1', '1.3', '1.3.2')
      anchor:
        type: string
        description: the heading text to be used in constracting a page anchor for linking
      html:
        type: string
        description: the heading display text (may contain HTML markup)
    required: [ level, section, number, anchor, html ]
    additionalProperties: false

  category:
    type: object
    properties:
      titles:
        type: object
        description: titles dictionary
        properties:
          canonical:
            type: string
            description: canonical title
          normalized:
            type: string
            description: normalized title
          display:
            type: string
            description: display title (omitting the "Category:" namespace prefix)
        required:
          - canonical
          - normalized
          - display
      summary_url:
        type: string
        description: link to REST API summary
      hidden:
        type: boolean
        description: whether the category is hidden or not
      ns:
        type: integer
        description: the numeric namespace id for the category page
    required: [ titles, hidden, summary_url, ns ]
    additionalProperties: false

  protection:
    type: object
    properties:
      edit:
        type: array
        description: list of groups with the 'edit' permission
        items:
          type: string
      move:
        type: array
        description: list of groups with the 'move' permission
        items:
          type: string

  references_response:
    type: object
    description: Reference lists and references
    properties:
      revision:
        type: string
        description: revision ID for the page
      tid:
        type: string
        description: time UUID for the page/revision
      reference_lists:
        $ref: '#/definitions/reference_lists'
      references_by_id:
        $ref: '#/definitions/references_by_id'
    additionalProperties: false
    required:
      - revision
      - tid
      - reference_lists
      - references_by_id

  reference_lists:
    type: array
    description: A list of reference lists
    items:
      $ref: '#/definitions/reference_list'

  reference_list:
    type: object
    description: A single reference list
    properties:
      id:
        type: ['string', 'null']
        description: Identifier for the whole reference list. May be null.
      section_heading:
        type: object
        description: |
          Object containing information about the section heading this reference list
          is shown in.
        properties:
          id:
            type: string
            description: Identifier for the section, which can be used to link to it
          html:
            type: string
            description: HTML content of section heading
      order:
        type: array
        description: |
          List of identifiers for individual references, which can be used to lookup
          the reference details in references_by_id.
        items:
          type: string
    additionalProperties: false
    required:
      - id
      - order

  references_by_id:
    type: object
    description: A map of reference ids to reference details
    properties:
      default:
        $ref: '#/definitions/reference_detail_item'

  reference_detail_item:
    type: object
    description: Information about one reference
    properties:
      back_links:
        type: array
        description: A list of back links, can be empty in rare cases
        items:
          $ref: '#/definitions/reference_detail_item_back_link'
      content:
        type: object
        properties:
          html:
            type: string
            description: HTML representation of the reference content
          type:
            type: string
            enum:
              - generic
              - book
              - journal
              - news
              - web
            description: Known citation type if there is exactly one cite tag, else 'generic'
    additionalProperties: false

  reference_detail_item_back_link:
    type: object
    description: Information about one link back to where on the page a given reference was used
    properties:
      href:
        type: string
        description: Relative URL pointing to anchor on same page
      text:
        type: string
        description: |
          Either an arrow for a single back link or another (usually single) chararacter
          to distinguish multiple back links.
    additionalProperties: false
    required:
      - href
      - text

  media_list:
    type: object
    properties:
      revision:
        type: string
        description: the revision ID used to create the list
      tid:
        type: string
        description: the time uuid of the page rendering used to create the list
      items:
        type: array
        description: a list of media items
        items:
          $ref: '#/definitions/media_item'
    required:
      - items
      - revision
      - tid

  media_item:
    type: object
    properties:
      title:
        type: string
        description: The file page title
      type:
        type: string
        enum:
          - image
          - video
          - audio
      section_id:
        type: integer
        description: section ID in which the item is found on the page
      showInGallery:
        type: boolean
        description: whether the client should show the file in an image gallery presentation
      caption:
        type: object
        properties:
          html:
            type: string
            description: on-wiki caption for the media item, including all HTML markup
          text:
            type: string
            description: plain text of the on-wiki caption for the media item
      original:
        type: object
        description: reference to a Mathoid-rendered math formula image
        properties:
          source:
            type: string
            description: Mathoid image render URL
          mime:
            type: string
            description: the Mathoid image mime type
    required:
      - type
      - section_id
      - showInGallery

  media_list_with_metadata:
    type: object
    properties:
      revision:
        type: string
        description: the revision ID used to create the list
      tid:
        type: string
        description: the time uuid of the page rendering used to create the list
      items:
        type: array
        description: a list of media items
        items:
          $ref: '#/definitions/media_item_with_metadata'
    required:
      - items
      - revision
      - tid

  media_item_with_metadata:
    type: object
    properties:
      titles:
        $ref: '#/definitions/titles_set'
      thumbnail:
        type: object
        properties:
          source:
            type: string
            description: thumb URL
          width:
            type: integer
            description: thumb width
          height:
            type: integer
            description: thumb height
          mime:
            type: string
            description: thumb MIME type
      original:
        type: object
        properties:
          source:
            type: string
            description: original URL
          width:
            type: integer
            description: original width
          height:
            type: integer
            description: original height
          mime:
            type: string
            description: original MIME type
          size:
            type: integer
            description: the original file size in bytes (sizes are not provided for video derivatives)
      page_count:
        type: integer
        description: page count, if the item is a paged item (PDF, TIFF, DjVu, etc.)
      file_page:
        type: string
        description: Full URL to the file page for the item on Wikimedia Commons
      type:
        type: string
        enum:
          - image
          - video
          - audio
      caption:
        type: object
        properties:
          html:
            type: string
            description: on-wiki caption for the media item, including all HTML markup
          text:
            type: string
            description: plain text of the on-wiki caption for the media item
      start_time:
        type: number
        description: start time (if any) for the media item
      end_time:
        type: number
        description: end time (if any) for the media item
      duration:
        type: number
        description: the playback duration in seconds (for audio and video items)
      sources:
        type: array
        description: a list of derivatives of the original file (applies only to videos)
        items:
          type: object
      artist:
        type: object
        description: structured info about the author of the media item
        properties:
          html:
            type: string
            description: HTML string describing the artist
          name:
            type: string
            description: the plain text artist name, if available
          user_page:
            type: string
            description: Wikimedia Commons user page for the artist, if available
        required:
          - html
      credit:
        $ref: '#/definitions/extmetadata_property'
      license:
        type: object
        description: license under which the media item is available on Wikimedia Commons
        properties:
          type:
            type: string
            description: license type
          url:
            type: string
            description: URL describing the terms and conditions of the license, if any
        required:
          - type
      license_url:
        type: string
        description: URL for the pertinent license
      description:
        $ref: '#/definitions/extmetadata_property'
      wb_entity_id:
        type: string
        description: Commons Wikibase ID, if the file is on Wikimedia Commons
      structured:
        type: object
        description: structured image metadata from SDC
        properties:
          captions:
            type: object
            description: caption (label) values by language
        required: [captions]
    required:
      - titles
      - file_page
      - type
      - thumbnail
      - license
      - structured

  action:
    type: object
    properties:
      title:
        type: string
        description: The title to display on the button that performs the action
      url:
        type: string
        description: The URL to navigate to when the button is pressed
    required:
      - title
      - url

  empty:
    type: object
    properties:
      type:
        type: string
        description: description of original content type (buffer)
      data:
        type: array
        description: Buffer contents
        items:
          type: string
    additionalProperties: false

  titles_set:
    type: object
    properties:
      canonical:
        type: string
        description: the DB key (non-prefixed)
      normalized:
        type: string
        description: the normalized title (https://www.mediawiki.org/wiki/API:Query#Title_normalization)
      display:
        type: string
        description: the title as it should be displayed to the user
    required:
      - canonical
      - normalized
      - display
    additionalProperties: false

  content_urls:
    type: object
    properties:
      page:
        type: string
        description: the canonical page URL
      revisions:
        type: string
        description: the revision history page URL
      edit:
        type: string
        description: the (desktop) URL for editing the page
      talk:
        type: string
        description: the talk page URL, if applicable
    required:
      - page
      - revisions
      - edit
    additionalProperties: false

  api_urls:
    type: object
    properties:
      summary:
        type: string
        description: the REST API summary URL for the page
     # read_html:
     #   type: string
     #   description: the REST API URL for the PCS read HTML for the page (not yet active)
     # content_html:
     #   type: string
     #   description: the REST API URL for the PCS content HTML for the page (not yet active)
      metadata:
        type: string
        description: the REST API URL for the page metadata (not yet active)
      references:
        type: string
        description: the REST API URL for the references on the page (not yet active)
      media:
        type: string
        description: the REST API URL for the media included in the page (not yet active)
      edit_html:
        type: string
        description: the REST API URL for the raw Parsoid HTML for the page
      talk_page_html:
        type: string
        description: the REST API URL for the raw Parsoid HTML for the talk page for this page (if applicable)
    required:
      - summary
     # - read_html
     # - content_html
      - metadata
      - references
      - media
      - edit_html
    additionalProperties: false
  talk_reply:
    type: object
    properties:
      sha:
        type: string
        description: SHA digest of reply HTML
      depth:
        type: integer
        description: depth level of reply
      html:
        type: string
        description: the reply HTML
    required: [sha, depth, html]
    additionalProperties: false

  talk_topic:
    type: object
    properties:
      id:
        type: integer
        description: topic ID
      replies:
        type: array
        description: replies to the topic
        items:
          $ref: '#/definitions/talk_reply'
      depth:
        type: integer
        description: depth level of topic
      html:
        type: string
        description: topic HTML
      shas:
        type: object
        properties:
          html:
            type: string
            description: SHA digest of topic HTML
          indicator:
            type: string
        required: [html, indicator]
        additionalProperties: false
    required: [id, replies, depth, html, shas]
    additionalProperties: false