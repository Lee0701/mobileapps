swagger: '2.0'

info:
  version: 0.3.0
  title: WMF MobileApps service
  description: |
    (aka Mobile Content Service and Page Content Service).
    A collection of REST API services supporting Wikimedia Foundation (WMF) Readers products.
    https://www.mediawiki.org/wiki/Wikimedia_Apps/Team/RESTBase_services_for_apps
  termsOfService: https://wikimediafoundation.org/wiki/Terms_of_Use
  contact:
    name: the Wikimedia Foundation Reading Infrastructure team.
    url: https://www.mediawiki.org/wiki/Wikimedia_Reading_Infrastructure_team
  license:
    name: Apache2
    url: http://www.apache.org/licenses/LICENSE-2.0

x-default-params:
  domain: en.wikipedia.org

parameters:
  domain:
    in: path
    name: domain
    required: true
    type: string
    description: |
      Project domain for the requested data.
  title:
    in: path
    name: title
    required: true
    type: string
    description: |
      Page title. Use underscores instead of spaces. Example: `Main_Page`
  revision:
    in: path
    name: revision
    required: false
    type: integer
    description: Revision ID
  tid:
    in: path
    name: tid
    required: false
    type: integer
    description: Time UUID of the rendering (used for rerenders when non-revision content changes)
  year:
    in: path
    name: year
    required: true
    type: integer
    description: Four digit year (2016 and later)
    minimum: 2016
    maximum: 2999
  month:
    in: path
    name: month
    required: true
    type: integer
    description: Two digit month, 0-padded if necessary (01 - 12)
    minimum: 01
    maximum: 31
  day:
    in: path
    name: day
    required: true
    type: integer
    description: Two digit day of the month, 0-padded if necessary (01 - 31)
    minimum: 01
    maximum: 31

paths:
  # from routes/root.js
  /robots.txt:
    get:
      tags:
        - Root
      description: Gets robots.txt
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-monitor: false

  /:
    get:
      tags:
        - Root
      description: The root service end-point
      produces:
        - application/json
        - application/problem+json
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: spec from root
          request:
            query:
              spec: true
          response:
            status: 200

  # from routes/info.js
  /_info:
    get:
      tags:
        - Root
      description: Gets information about the service.
      produces:
        - application/json
        - application/problem+json
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve service info
          request: {}
          response:
            status: 200
            headers:
              content-type: application/json
            body:
              name: /.+/
              description: /.+/
              version: /.+/
              home: /.+/

  # from routes/feed/availability.js
  /{domain}/v1/feed/availability:
    get:
      tags:
        - Feed
      summary: Get availability of featured feed content by wiki domain.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Availability/1.0.1"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Availability of the feed content by wiki domain
          schema:
            $ref: '#/definitions/availability'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Retrieve feed content availability from \'wikipedia.org\'
          request:
            params:
              domain: wikimedia.org
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Availability/1.0.1"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              todays_featured_article: [ /.+/ ]
              most_read: [ '*' ]
              picture_of_the_day: [ '*' ]
              in_the_news: [ /.+/ ]
              on_this_day: [ /.+/ ]

  # from routes/feed/announcements.js
  /{domain}/v1/feed/announcements:
    get:
      tags:
        - Feed
      summary: Get announcements for the Explore feed in the mobile apps.
      description: |
        Gets announcements for display in the official Wikipedia iOS and Android apps.
        This is usually used to show announcements for surveys or fundraising.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Announcements/0.2.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Announcements for the given Wiki
          schema:
            $ref: '#/definitions/announcements'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Retrieve announcements
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Announcements/0.2.0"
              cache-control: public, max-age=7200, s-maxage=14400
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN

  # from routes/feed/on-this-day.js
  /{domain}/v1/feed/onthisday/{type}/{month}/{day}:
    get:
      tags:
        - Feed
      summary: Get events on this day in history for the Explore feed.
      description: |
        Provides events that historically happened on the provided day and month.
        Supported types of events are:
         - Selected: a list of a few selected anniversaries which happen on the provided day and month; often the entries are curated for the current year
         - Births: a list of birthdays which happened on the provided day and month
         - Deaths: a list of deaths which happened on the provided day and month
         - Holidays: a list of fixed holidays celebrated on the provided day and month
         - Events: a list of significant events which happened on the provided day and month and which are not covered by the other types yet
         - All: all of the above
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/OnThisDay/0.3.3"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - name: type
          in: path
          description: Type of events
          type: string
          required: true
          enum:
            - selected
            - births
            - deaths
            - holidays
            - events
            - all
        - $ref: '#/parameters/month'
        - $ref: '#/parameters/day'

      responses:
        200:
          description: Annual events listed on this wiki for the requested month and day
          schema:
            $ref: '#/definitions/onthisdayResponse'
        404:
          description: No data found for the requested date
          schema:
            $ref: '#/definitions/problem'
        501:
          description: Unsupported language
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve all events on January 15
          request:
            params:
              type: all
              month: 01
              day: 15
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/OnThisDay/0.3.3"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              selected:
                - text: /.+/
                  year: /.+/
                  pages:
                    - $merge: [ /.+/ ]
              events:
                - text: /.+/
                  year: /.+/
                  pages:
                    - $merge: [ /.+/ ]
              births:
                - text: /.+/
                  year: /.+/
                  pages:
                    - $merge: [ /.+/ ]
              deaths:
                - text: /.+/
                  year: /.+/
                  pages:
                    - $merge: [ /.+/ ]
              holidays:
                - text: /.+/
                  pages:
                    - $merge: [ /.+/ ]

  # from routes/feed/featured.js
  /{domain}/v1/page/featured/{year}/{month}/{day}:
    get:
      tags:
        - Feed
      summary: Get featured article of the day for the Explore feed.
      description: |
        Page title of "Today's featured article" (only works on select wikis for now).
      produces:
        - application/json
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/year'
        - $ref: '#/parameters/month'
        - $ref: '#/parameters/day'
      responses:
        200:
          description: The title of a Wikipedia's Featured Article of the Day
          schema:
            $ref: '#/definitions/article_summary_merge_link'
        204:
          description: Empty response (for feed content aggregation requests from RESTBase)
          schema:
            $ref: '#/definitions/empty'
        404:
          description: Not found
          schema:
            $ref: '#/definitions/problem'
        500:
          description: API Error
          schema:
            $ref: '#/definitions/problem'
        501:
          description: Unsupported language
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve title of the featured article for April 29, 2016
          request:
            params:
              year: 2016
              month: '04'
              day: 29
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              $merge: [ /.+/ ]
        - title: retrieve featured article info for unsupported site (with aggregated=true)
          request:
            params:
              domain: is.wikipedia.org
              year: 2016
              month: '04'
              day: 29
            query:
              aggregated: true
          response:
            status: 204
            body: ''

  # from routes/feed/featured-image.js
  /{domain}/v1/media/image/featured/{year}/{month}/{day}:
    get:
      tags:
        - Feed
      summary: Get the Picture of the Day from Wikimedia Commons for the Explore feed.
      description: |
        Featured image for a given date (aka Picture of the day).
        Provides thumbnail and full res image URLs and a localized description based
        on the domain used.
      produces:
        - application/json
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/year'
        - $ref: '#/parameters/month'
        - $ref: '#/parameters/day'
      responses:
        200:
          description: Info on the Commons Featured Image of the Day for the requested date
          schema:
            $ref: '#/definitions/image'
        204:
          description: Empty response (for feed content aggregation requests from RESTBase)
          schema:
            $ref: '#/definitions/empty'
        404:
          description: Not found (no featured image for the requested date)
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve featured image data for April 29, 2016
          request:
            params:
              year: 2016
              month: '04'
              day: 29
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              title: /.+/
              description:
                text: /.+/
                lang: /.+/
              image:
                source: /.+/
                width: /.+/
                height: /.+/
              thumbnail:
                source: /.+/
                width: /.+/
                height: /.+/

  # from routes/feed/most-read.js
  /{domain}/v1/page/most-read/{year}/{month}/{day}:
    get:
      tags:
        - Feed
      summary: Get most viewed pages for a date.
      description: |
        Gets the most read articles for the date provided.
        The date is in UTC, as other endpoints, too.
        Only days prior to today's date are accepted.
      produces:
        - application/json
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/year'
        - $ref: '#/parameters/month'
        - $ref: '#/parameters/day'
      responses:
        200:
          description: Most read article titles for this wiki for the requested date
          schema:
            $ref: '#/definitions/mostread'
        204:
          description: Empty response (for feed content aggregation requests from RESTBase)
          schema:
            $ref: '#/definitions/empty'
        404:
          description: No data found for the requested date
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve the most read articles for January 1, 2016
          request:
            params:
              year: 2016
              month: '01'
              day: '01'
          response:
            status: 200
            headers:
              content-type: application/json
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              date: '2016-01-01Z'
              articles:
                - views: /.+/
                  rank: /.+/
                  $merge: [ /.+/ ]
        - title: retrieve the most-read articles for January 1, 2016 (with aggregated=true)
          request:
            params:
              year: 2016
              month: '01'
              day: '01'
            query:
              aggregated: true
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              date: '2015-12-31Z'
              articles:
                - views: /.+/
                  rank: /.+/
                  $merge: [ /.+/ ]
        - title: retrieve most-read articles for date with no data (with aggregated=true)
          request:
            params:
              year: 2015
              month: '01'
              day: '01'
            query:
              aggregated: true
          response:
            status: 204
            body: ''

  # from routes/page/random.js
  /{domain}/v1/page/random/title:
    get:
      tags:
        - Feed
      summary: Get a random article title.
      description: |
        Gets the title of a randomly picked article from main namespace.
        Preference is given to articles with a thumbnail, long extract,
        and an associated Wikidata description.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Random/0.6.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: A random (good) article title
          schema:
            $ref: '#/definitions/random'
        400:
          description: Bad request
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve a random article title
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Random/0.6.0"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              items:
                - title: /.+/

  # from routes/feed/news.js
  /{domain}/v1/page/news:
    get:
      tags:
        - Feed
      summary: Get current news headlines.
      description: |
        Gets content related to the current "In the News" template
        (for some wikis for now).
      produces:
        - application/json
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: News content from the a Wikipedia main page
          schema:
            $ref: '#/definitions/news'
        204:
          description: Empty response (for feed content aggregation requests from RESTBase)
          schema:
            $ref: '#/definitions/empty'
        501:
          description: Unsupported language
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: get 'In the News' content
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              - story: /.+/
                links:
                  - $merge: [ /.+/ ]
        - title: get "In the News" content for unsupported language (with aggregated=true)
          request:
            params:
              domain: is.wikipedia.org
            query:
              aggregated: true
          response:
            status: 204
            body: ''

  # from routes/page/media.js
  /{domain}/v1/page/media/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get information on media files used on a page.
      description: |
        Gets the media items (images, audio, and video) in the order in which they appear on a
        given wiki page.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Media/1.4.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Gets media items from a wiki page
          schema:
            $ref: '#/definitions/media_list'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get media in test page
          request:
            params:
              title: User:BSitzmann_(WMF)/MCS/Test/Frankenstein
              revision: 803891963
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Media/1.4.0"
              content-language: en
              vary: Accept, Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              revision: /.+/
              tid: /.+/
              items:
                - section_id: /.+/
                  type: /.+/

  # from routes/page/metadata.js
  /{domain}/v1/page/metadata/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get extended metadata about a page.
      description: |
        Gets additional metadata about a page, primarily from the MediaWiki API.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Metadata/1.2.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Extended article metadata
          schema:
            $ref: '#/definitions/metadata'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve extended metadata for Video article on English Wikipedia
          request:
            params:
              title: Video
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Metadata/1.2.0"
              content-language: en
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              revision: /.+/
              tid: /.+/
              hatnotes:
                - section: /.+/
                  html: /.+/
              issues:
                - section: /.+/
                  html: /.+/
              toc:
                title: /.+/
                entries:
                  - level: /.+/
                    section: /.+/
                    number: /.+/
                    anchor: /.+/
                    html: /.+/
              language_links:
                - lang: /.+/
                  titles:
                    canonical: /.+/
                    normalized: /.+/
                  summary_url: /.+/
              categories:
                - titles:
                    canonical: /.+/
                    normalized: /.+/
                    display: /.+/
                  hidden: /.+/
                  ns: /.+/
                  summary_url: /.+/
              protection:
                edit: [ /.+/ ]
                move: [ /.+/ ]
              description_source: /.+/

  # from routes/page/references.js
  /{domain}/v1/page/references/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get reference lists and reference details.
      description: |
        Gets a list of reference lists and a map of reference ids to details for all references
        appearing on the equivalent page. This content is parsed from Parsoid output.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/References/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        '200':
          description: Reference lists and reference details
          schema:
            $ref: '#/definitions/references_response'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get references of a test page
          request:
            params:
              title: Video
              revision: 830543386
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/References/1.0.0"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              revision: /.+/
              tid: /.+/
              reference_lists:
                - id: /.*/
                  section_heading:
                    id: /.+/
                    html: /.+/
                  order: [ /.*/ ]
              references_by_id: /.+/

  # from routes/page/definition.js
  /{domain}/v1/page/definition/{title}{/revision}{/tid}:
    get:
      tags:
        - Word definitions (English Wiktionary only)
      summary: Get Wiktionary definitions for a word.
      description: Gets definitions for a word parsed from an article in Wiktionary.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/definition/0.8.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Structured definition for the term
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve en-wiktionary definitions for 'cat'
          request:
            params:
              domain: en.wiktionary.org
              title: cat
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/definition/0.8.0"
              content-language: en
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body: /.+/

  # from routes/page/summary.js
  /{domain}/v1/page/summary/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get basic metadata and simplified article introduction.
      description: |
        The summary response includes an extract of the first paragraph of the page in plain text
        and HTML as well as the type of page. This is useful for page previews (fka. Hovercards,
        aka. Popups) on the web and link previews in the apps.

        Stability: [unstable](https://www.mediawiki.org/wiki/API_versioning#Unstable)
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Summary/1.3.7"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: The summary for the given page
          schema:
            $ref: '#/definitions/summary'
        404:
          description: Unknown page title or revision
          schema:
            $ref: '#/definitions/problem'
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get summary for test page
          request:
            params:
              title: San_Francisco
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Summary/1.3.7"
              content-language: en
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              type: standard
              title: /.+/
              displaytitle: /.+/
              namespace:
                id: /.+/
                text: /.*/
              titles:
                canonical: /.+/
                normalized: /.+/
                display: /.+/
              pageid: /.+/
              thumbnail:
                source: /.+/
                width: /.+/
                height: /.+/
              originalimage:
                source: /.+/
                width: /.+/
                height: /.+/
              lang: /.+/
              dir: /.+/
              revision: /.+/
              tid: /.+/
              timestamp: /.+/
              coordinates:
                lat: /.+/
                lon: /.+/
              description: /.+/
              content_urls:
                desktop:
                  page: /.+/
                  revisions: /.+/
                  edit: /.+/
                  talk: /.+/
                mobile:
                  page: /.+/
                  revisions: /.+/
                  edit: /.+/
                  talk: /.+/
              api_urls:
                summary: /.+/
#                mobile_html: /.+/
                metadata: /.+/
                references: /.+/
                media: /.+/
                edit_html: /.+/
                talk_page_html: /.+/
              extract: /.+/
              extract_html: /.+/

  # from routes/page/mobile-sections.js
  /{domain}/v1/page/mobile-sections/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get metadata and all sections of a page.
      description: |
        Gets the full page content of a given wiki page for the Android app.
        For a faster page load experience the Android app uses the following two endpoints instead.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/mobile-sections/0.14.3"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Structured info about a page and its sections
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: retrieve test page via mobile-sections
          request:
            params:
              title: User:BSitzmann_(WMF)/MCS/Test/Frankenstein
              revision: 803891963
          response:
            status: 200
            headers:
              content-type: application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/mobile-sections/0.14.3"
              content-language: en
              vary: Accept, Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body:
              lead:
                id: /.+/
                revision: /.+/
                lastmodified: /.+/
                lastmodifier: /.+/
                displaytitle: /.+/
                normalizedtitle: /.+/
                protection: /.+/
                editable: /.+/
                languagecount: /.+/
                ns: /.+/
                sections:
                  - id: /.+/
              remaining:
                sections:
                  - id: /.+/
                    text: /.*/
                    toclevel: /.+/
                    line: /.+/
                    anchor: /.+/

  /{domain}/v1/page/mobile-sections-lead/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get lead section and metadata for a page.
      description: |
        Gets the lead section and general metadata of a given wiki page for the Android app.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/mobile-sections/0.14.3"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Structured info a page and its lead section
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-monitor: false

  /{domain}/v1/page/mobile-sections-remaining/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get non-lead sections of a page.
      description: Gets the remaining sections of a given wiki page for the Android app.
      produces:
        - application/json; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/mobile-sections/0.14.3"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Structured info on non-lead sections for a page
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-monitor: false

  /{domain}/v1/page/mobile-html/{title}{/revision}{/tid}:
    get:
      tags:
        - Page content
      summary: Get page content HTML optimized for mobile consumption
      description: |
        Gets the content HTML optimized for mobile consumption for the given page. This content
        is derived from Parsoid HTML (see `/page/html/{title}` endpoint).
        The difference to Parsoid HTML is roughly:
        * Some elements and attributes not needed for the reading case are removed.
        * LeadIntroductionTransform: The introductory paragraph is moved before an infobox.
        * RedLinks: Red links are flattened (=turned into span elements).
        * WidenImage: images that should be displayed in gallery are widened.
        * Section headings are slightly changed by wrapping the headings inside a div and adding
          a span element inside the new div for the edit buttons.
        * Additional classes are added to img elements to fix issues with non-white backgrounds.
          See Theme support below for instructions on how to enable that.
        * Pagelib CSS files needed to display the content are referenced.
        * LazyLoadTransform: server-side portion/prep for lazy loading of images.

        What's not included? What parts of the PageLibrary does a client still have to do?
        * Theme support: Themes can be turned on by adding a theme class to the root <html> tag.
          Possible class names are:
          * `pagelib_theme_default`
          * `pagelib_theme_dark`
          * `pagelib_theme_black`
          * `pagelib_theme_sepia`

          The pagelib JS has functionality to do that: ThemeTransform.setTheme(document, theme).
        * Dim images: DimImagesTransform.dim(window, enable)
        * PlatformTransform.classify(window) to trigger Android and iOS app specific CSS rules
        * LazyLoadTransformer: client side companion of LazyLoadTransform (note the extra *er*
        here)
        * CollapseTable: server-side portion/prep for collapsing tables.
        * FooterTransformer: seems to be more UI than content, requires I18N, too
      produces:
        - text/html; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Mobile-HTML/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
        - $ref: '#/parameters/title'
        - $ref: '#/parameters/revision'
        - $ref: '#/parameters/tid'
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get page content HTML for test page
          request:
            params:
              title: User:BSitzmann_(WMF)/MCS/Test/Frankenstein
          response:
            status: 200
            headers:
              content-type: text/html; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/Mobile-HTML/1.0.0"
              content-language: en
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN

  /{domain}/v1/data/css/mobile/base:
    get:
      tags:
        - Page styles
      summary: Get base page styles
      description: Gets the base styles used for viewing all pages in the mobile apps
      produces:
        - text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get base CSS
          response:
            status: 200
            headers:
              content-type: text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body: /.+/

  /{domain}/v1/data/css/mobile/pagelib:
    get:
      tags:
        - Page styles
      summary: Get styles from the wikimedia-page-library
      description: |
        Gets the styles needed for proper display of page content after the
        transforms from the wikimedia-page-library are applied.
      produces:
        - text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get CSS bundle from wikimedia-page-library
          response:
            status: 200
            headers:
              content-type: text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body: /.+/

  /{domain}/v1/data/css/mobile/site:
    get:
      tags:
        - Page styles
      summary: Get site-wide mobile styles
      description: Gets the site-wide mobile styles for the site, as defined in MediaWiki\:Mobile.css
      produces:
        - text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get site-specific CSS
          response:
            status: 200
            headers:
              content-type: text/css; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/CSS/1.0.0"
              vary: Accept-Encoding
              cache-control: public, max-age=86400, s-maxage=86400
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body: /.+/

  /{domain}/v1/data/javascript/mobile/pagelib:
    get:
      tags:
        - Scripts
      summary: Get javascript bundle for page library
      description: |
        Gets the javascript bundle from the wikimedia-page-library so that clients can have
        convenient access to that for consuming the mobile-html HTML.
        Amongst other things,
        * it allows to detect the platform and through that enable platform specific CSS rules,
        * has code to lazy load images on the page,
        * code for collapsing and expanding tables.
      produces:
        - text/javascript; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/JavaScript/1.0.0"
        - application/problem+json
      parameters:
        - $ref: '#/parameters/domain'
      responses:
        200:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/problem'
      x-amples:
        - title: Get javascript bundle for page library
          response:
            status: 200
            headers:
              content-type: text/javascript; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/JavaScript/1.0.0"
              vary: Accept-Encoding
              etag: /^"[^/"]+/[^/"]+"$/
              access-control-allow-origin: '*'
              access-control-allow-headers: accept, x-requested-with, content-type
              content-security-policy: default-src
              x-content-security-policy: default-src
              x-frame-options: SAMEORIGIN
            body: /.+/

definitions:
  # A https://tools.ietf.org/html/draft-nottingham-http-problem
  problem:
    required:
      - type
    properties:
      status:
        type: integer
      type:
        type: string
      title:
        type: string
      detail:
        type: string
      method:
        type: string
      uri:
        type: string

  article_title:
    type: object
    properties:
      title:
        type: string
        description: An article title
    required:
      - title

  article_summary_merge_link:
    type: object
    properties:
      $merge:
        type: array
        description: One-element array containing the link to the RESTBase summary for the article
        items:
          type: string
    required:
      - $merge

  image_props:
    type: object
    properties:
      source:
        type: string
        description: URI
      width:
        type: integer
        minimum: 0
        description: width (px)
      height:
        type: integer
        minimum: 0
        description: height (px)
      mime:
        type: string
        description: MIME type
    required:
      - source
      - width
      - height
    additionalProperties: false

  # see also RB v1/common_schemas.yaml
  summary:
    type: object
    properties:
      type:
        type: string
        description: Type of page summary
        enum:
          - standard
          - disambiguation
      title:
        type: string
        description: The page title
      displaytitle:
        type: string
        description: The page title how it should be shown to the user
      namespace:_id:
        type: object
        properties:
          id:
            type: integer
            description: the numeric ID for the page's namespace (https://www.mediawiki.org/wiki/Manual:Namespace)
          text:
            type: string
            description: localized text name for the MediaWiki namespace
        required: [ id, text ]
        additionalProperties: false
      titles:
        $ref: '#/definitions/titles_set'
      pageid:
        type: integer
        description: The page ID
      revision:
        type: string
        description: The revision of the page when the summary was produced
      tid:
        type: string
        description: The timeuuid associated with the underlying HTML content
      extract:
        type: string
        description: First several sentences of an article in plain text
      extract_html:
        type: string
        description: First several sentences of an article in simple HTML format
      thumbnail:
        $ref: '#/definitions/image_props'
      originalimage:
        $ref: '#/definitions/image_props'
      lang:
        type: string
        description: The page language code
        example: en
      dir:
        type: string
        description: The page language direction code
        enum:
          - ltr
          - rtl
      timestamp:
        type: string
        format: date-time
        description: The time when the page was last editted in the [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) format
        example: '1970-01-01T00:00:00.000Z'
      description:
        type: string
        description: short description for the page
        example: American poet
      content_urls:
        type: object
        properties:
          desktop:
            $ref: '#/definitions/content_urls'
          mobile:
            $ref: '#/definitions/content_urls'
      api_urls:
        $ref: '#/definitions/api_urls'
      coordinates:
        type: object
        description: The coordinates of the item
        properties:
          lat:
            type: number
            description: The latitude
          lon:
            type: number
            description: The longitude
        required: [ 'lat', 'lon' ]
    required:
      - type
      - title
      - displaytitle
      - pageid
      - lang
      - dir
      - revision
      - timestamp
      - content_urls
      - api_urls
      - extract
      - extract_html

  dated_pageview:
    type: object
    properties:
      date:
        type: string
        description: ISO 8601 timestamp of pageviews recorded
      views:
        type: integer
        description: Number of views on date
    required:
      - date
      - views
    additionalProperties: false

  mostread_article:
    type: object
    properties:
      $merge:
        type: array
        description: One-element array containing the link to the RESTBase summary for the article
        items:
          type: string
      views:
        type: integer
        description: Number of views on the requested day
      view_history:
        type: array
        items:
          $ref: '#/definitions/dated_pageview'
      rank:
        type: integer
        description: Position in the list of most viewed articles
    required:
      - $merge
      - views
      - rank

  mostread:
    type: object
    properties:
      date:
        type: string
        description: The date which the data correspond to
      articles:
        type: array
        description: Array of most popular articles
        items:
          $ref: '#/definitions/mostread_article'
    required:
      - date
      - articles

  onthisdayList:
    type: array
    items:
      type: object
      properties:
        text:
          type: string
          description: Short description of the event
        year:
          type: integer
          description: The year this event occurred
        pages:
          type: array
          description: List of pages related to the event
          items:
            $ref: '#/definitions/article_summary_merge_link'
    required:
      - text
      - pages

  onthisdayResponse:
    type: object
    description: Lists of events which happened on the provided day and month
    properties:
      births:
        $ref: '#/definitions/onthisdayList'
      deaths:
        $ref: '#/definitions/onthisdayList'
      events:
        $ref: '#/definitions/onthisdayList'
      holidays:
        $ref: '#/definitions/onthisdayList'
      selected:
        $ref: '#/definitions/onthisdayList'
    additionalProperties: false

  news_item:
    type: object
    properties:
      story:
        type: string
        description: A cover story for the news item
      links:
        type: array
        description: |
          A collection of pages mentioned in the headline. The first page is the headline topic.
        items:
          $ref: '#/definitions/article_summary_merge_link'
    required:
      - story
      - links

  news:
    type: array
    items:
      $ref: '#/definitions/news_item'

  random:
    type: object
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/article_title'
    required:
      - items

  image_description:
    properties:
      text:
        type: string
        description: Text of the description
      lang:
        type: string
        description: Language code of the description
    required:
      - text
      - lang

  image:
    type: object
    properties:
      title:
        type: string
        description: Image title
      thumbnail:
        $ref: '#/definitions/image_props'
      image:
        $ref: '#/definitions/image_props'
      description:
        $ref: '#/definitions/image_description'
    required:
      - title
      - thumbnail
      - image

  announcements:
    type: object
    properties:
      announce:
        type: array
        description: list of active announcements for this wiki
        items:
          $ref: '#/definitions/announcement'
    required:
      - announce

  availability:
    type: object
    properties:
      todays_featured_article:
        type: array
        description: domains for wikis with this feature enabled, or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      most_read:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      picture_of_the_day:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      in_the_news:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
      on_this_day:
        type: array
        description: domains for wikis with this feature enabled or [ '*.<project>.org' ] for all wikis in a project
        items:
          type: string
    required: [ todays_featured_article, most_read, picture_of_the_day, in_the_news, on_this_day ]
    additionalProperties: false

  announcement:
    type: object
    properties:
      id:
        type: string
        description: Unique ID of the announcement
      type:
        type: string
        description: The announcement type
        enum:
          - survey
          - fundraising
          - announcement
      start_time:
        type: string
        description: The ISO 8601 date to begin showing the announcement.
      end_time:
        type: string
        description: The ISO 8601 date to stop showing the announcement.
      platforms:
        type: array
        description: |
          An array of platforms on which to display the announcement.
        items:
          type: string
          enum:
            - iOSApp
            - AndroidApp
            - AndroidAppV2
      text:
        type: string
        description: The text of the announcement
      image:
        type: string
        description: \[DEPRECATED\] The URL of the image for the announcement (Android only)
      image_url:
        type: string
        description: The URL of the image for the announcement
      action:
        $ref: '#/definitions/action'
      caption_HTML:
        type: string
        description: HTML to display below the announcement. Usually a privacy statment and link to a policy
      countries:
        type: array
        description: |
          An array of country codes in which to display the announcement. Clients should derive
          the country from 'GeoIP' portion of the Set-Cookie header.
        items:
          type: string
      min_version:
        type: string
        description: minimum app version code for which to show the announcement
      max_version:
        type: string
        description: maximum app version code for which to show the announcement
      beta:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling the release builds for which the announcement should be shown.
          Set to true if the announcement should be shown only in pre-production builds (beta, alpha, dev).
          Set to false if the announcement should be shown only in release builds.
          If not defined, the announcement will be shown for all builds.
      logged_in:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on the user login state.
          Set to true if the announcement should be shown only if the user is logged in.
          Set to false if the announcement should be shown only if the user is NOT logged in.
          If not defined, the announcement will be shown regardless of the user's login state.
      reading_list_sync_enabled:
        type: boolean
        description: |
          (AndroidAppV2 only) Optional boolean flag controlling whether announcements should be shown based on whether the user
          has enabled reading list syncing.
          Set to true if the announcement should be shown only if the user has enabled reading list syncing.
          Set to false if the announcement should be shown only if the user has NOT enabled reading list syncing.
          If not defined, the announcement will be shown regardless of whether the user has enabled reading list syncing.
      negative_text:
        type: string
        description: |
          (AndroidAppV2 only) text to show on a "negative" button on the announcement. If absent, the button is not shown
      image_height:
        type: integer
        description: |
          (AndroidAppV2 only) height, in device-independent pixels, of the image portion of the announcement card
    required:
      - id
      - type
      - start_time
      - end_time
      - platforms
      - text
      - countries
      - action

  metadata:
    type: object
    properties:
      revision:
        type: string
        description: revision ID for the page
      tid:
        type: string
        description: time UUID for the page/revision
      hatnotes:
        type: array
        description: the hatnotes on the page, with html and plaintext representations provided for each
        items:
          $ref: '#/definitions/hatnote_or_page_issue'
      issues:
        type: array
        description: the page issues on the page, with html and plaintext representations provided for each
        items:
          $ref: '#/definitions/hatnote_or_page_issue'
      toc:
        type: object
        description: a table of contents for the page, in structured form
        properties:
          title:
            type: string
            description: the TOC title string for the wiki as reported by siteinfo
          entries:
            type: array
            description: section info for the TOC in structured form
            items:
              $ref: '#/definitions/toc_entry'
        required: [ title, entries ]
        additionalProperties: false
      language_links:
        type: array
        description: list of titles and language codes for the article topic on other language Wikipedias
        items:
          type: object
          description: titles and language codes for the article topic on another language Wikipedia
          properties:
            lang:
              type: string
              description: language code
            titles:
              type: object
              description: titles dictionary
              properties:
                canonical:
                  type: string
                  description: canonical title
                normalized:
                  type: string
                  description: normalized title
              required:
                - canonical
                - normalized
            summary_url:
              type: string
              description: link to REST API summary
          required:
            - lang
            - titles
            - summary_url
      categories:
        type: array
        description: categories the page belongs to
        items:
          $ref: '#/definitions/category'
      protection:
        type: object
        description: info on page edit and move rights
        items:
          $ref: '#/definitions/protection'
      description_source:
        type: string
        enum:
          - central
          - local
        description: Whether the description is defined locally or comes from Wikidata.  May be 'central' or 'local'.
      variants:
        type: object
    required: [ revision, tid, protection ]
    additionalProperties: false

  hatnote_or_page_issue:
    type: object
    properties:
      section:
        type: integer
        description: section ID containing the hatnote or page issue
      html:
        type: string
        description: the hatnote or page issue HTML
    required: [ section, html ]
    additionalProperties: false

  toc_entry:
    type: object
    properties:
      level:
        type: integer
        description: the depth of the heading in the TOC hierarchy
      section:
        type: integer
        description: the position of the section in the order of appearance of all sections on the page
      number:
        type: string
        description: a numeric representation of the section's position in the page hierarhcy (e.g., '1', '1.3', '1.3.2')
      anchor:
        type: string
        description: the heading text to be used in constracting a page anchor for linking
      html:
        type: string
        description: the heading display text (may contain HTML markup)
    required: [ level, section, number, anchor, html ]
    additionalProperties: false

  category:
    type: object
    properties:
      titles:
        type: object
        description: titles dictionary
        properties:
          canonical:
            type: string
            description: canonical title
          normalized:
            type: string
            description: normalized title
          display:
            type: string
            description: display title (omitting the "Category:" namespace prefix)
        required:
          - canonical
          - normalized
          - display
      summary_url:
        type: string
        description: link to REST API summary
      hidden:
        type: boolean
        description: whether the category is hidden or not
      ns:
        type: integer
        description: the numeric namespace id for the category page
    required: [ titles, hidden, summary_url, ns ]
    additionalProperties: false

  protection:
    type: object
    properties:
      edit:
        type: array
        description: list of groups with the 'edit' permission
        items:
          type: string
      move:
        type: array
        description: list of groups with the 'move' permission
        items:
          type: string

  references_response:
    type: object
    description: Reference lists and references
    properties:
      revision:
        type: string
        description: revision ID for the page
      tid:
        type: string
        description: time UUID for the page/revision
      reference_lists:
        $ref: '#/definitions/reference_lists'
      references_by_id:
        $ref: '#/definitions/references_by_id'
    additionalProperties: false
    required:
      - revision
      - tid
      - reference_lists
      - references_by_id

  reference_lists:
    type: array
    description: A list of reference lists
    items:
      $ref: '#/definitions/reference_list'

  reference_list:
    type: object
    description: A single reference list
    properties:
      id:
        type: ['string', 'null']
        description: Identifier for the whole reference list. May be null.
      section_heading:
        type: object
        description: |
          Object containing information about the section heading this reference list
          is shown in.
        properties:
          id:
            type: string
            description: Identifier for the section, which can be used to link to it
          html:
            type: string
            description: HTML content of section heading
      order:
        type: array
        description: |
          List of identifiers for individual references, which can be used to lookup
          the reference details in references_by_id.
        items:
          type: string
    additionalProperties: false
    required:
      - id
      - order

  references_by_id:
    type: object
    description: A map of reference ids to reference details
    properties:
      default:
        $ref: '#/definitions/reference_detail_item'

  reference_detail_item:
    type: object
    description: Information about one reference
    properties:
      back_links:
        type: array
        description: A list of back links, can be empty in rare cases
        items:
          $ref: '#/definitions/reference_detail_item_back_link'
      content:
        type: object
        properties:
          html:
            type: string
            description: HTML representation of the reference content
          type:
            type: string
            enum:
              - generic
              - book
              - journal
              - news
              - web
            description: Known citation type if there is exactly one cite tag, else 'generic'
    additionalProperties: false

  reference_detail_item_back_link:
    type: object
    description: Information about one link back to where on the page a given reference was used
    properties:
      href:
        type: string
        description: Relative URL pointing to anchor on same page
      text:
        type: string
        description: |
          Either an arrow for a single back link or another (usually single) chararacter
          to distinguish multiple back links.
    additionalProperties: false
    required:
      - href
      - text

  media_list:
    type: object
    properties:
      revision:
        type: string
        description: the revision ID used to create the list
      tid:
        type: string
        description: the time uuid of the page rendering used to create the list
      items:
        type: array
        description: a list of media items
        items:
          $ref: '#/definitions/media_item'
    required:
      - items
      - revision
      - tid

  media_item:
    type: object
    properties:
      titles:
        $ref: '#/definitions/titles_set'
      thumbnail:
        type: object
        properties:
          source:
            type: string
            description: thumb URL
          width:
            type: integer
            description: thumb width
          height:
            type: integer
            description: thumb height
          mime:
            type: string
            description: thumb MIME type
      original:
        type: object
        properties:
          source:
            type: string
            description: original URL
          width:
            type: integer
            description: original width
          height:
            type: integer
            description: original height
          mime:
            type: string
            description: original MIME type
          size:
            type: integer
            description: the original file size in bytes (sizes are not provided for video derivatives)
      page_count:
        type: integer
        description: page count, if the item is a paged item (PDF, TIFF, DjVu, etc.)
      file_page:
        type: string
        description: Full URL to the file page for the item on Wikimedia Commons
      type:
        type: string
        enum:
          - image
          - video
          - audio
      caption:
        type: object
        properties:
          html:
            type: string
            description: on-wiki caption for the media item, including all HTML markup
          text:
            type: string
            description: plain text of the on-wiki caption for the media item
      start_time:
        type: number
        description: start time (if any) for the media item
      end_time:
        type: number
        description: end time (if any) for the media item
      duration:
        type: number
        description: the playback duration in seconds (for audio and video items)
      sources:
        type: array
        description: a list of derivatives of the original file (applies only to videos)
        items:
          type: object
      artist:
        type: object
        description: structured info about the author of the media item
        properties:
          html:
            type: string
            description: HTML string describing the artist
          name:
            type: string
            description: the plain text artist name, if available
          user_page:
            type: string
            description: Wikimedia Commons user page for the artist, if available
        required:
          - html
      credit:
        type: string
        description: source of the media item
      license:
        type: object
        description: license under which the media item is available on Wikimedia Commons
        properties:
          type:
            type: string
            description: license type
          url:
            type: string
            description: URL describing the terms and conditions of the license, if any
        required:
          - type
      license_url:
        type: string
        description: URL for the pertinent license
      description:
        type: object
        description: description of the image from Wikimedia Commons
        properties:
          html:
            type: string
            description: html image description
          text:
            type: string
            description: plain text image description
          lang:
            type: string
            description: wiki language code of the description (if available)
        required: [ html, text ]
    required:
      - titles
      - file_page
      - type
      - thumbnail
      - license

  action:
    type: object
    properties:
      title:
        type: string
        description: The title to display on the button that performs the action
      url:
        type: string
        description: The URL to navigate to when the button is pressed
    required:
      - title
      - url

  empty:
    type: object
    properties:
      type:
        type: string
        description: description of original content type (buffer)
      data:
        type: array
        description: Buffer contents
        items:
          type: string
    additionalProperties: false

  titles_set:
    type: object
    properties:
      canonical:
        type: string
        description: the DB key (non-prefixed)
      normalized:
        type: string
        description: the normalized title (https://www.mediawiki.org/wiki/API:Query#Title_normalization)
      display:
        type: string
        description: the title as it should be displayed to the user
    required:
      - canonical
      - normalized
      - display
    additionalProperties: false

  content_urls:
    type: object
    properties:
      page:
        type: string
        description: the canonical page URL
      revisions:
        type: string
        description: the revision history page URL
      edit:
        type: string
        description: the (desktop) URL for editing the page
      talk:
        type: string
        description: the talk page URL, if applicable
    required:
      - page
      - revisions
      - edit
    additionalProperties: false

  api_urls:
    type: object
    properties:
      summary:
        type: string
        description: the REST API summary URL for the page
#      read_html:
#        type: string
#        description: the REST API URL for the PCS read HTML for the page (not yet active)
#      content_html:
#        type: string
#        description: the REST API URL for the PCS content HTML for the page (not yet active)
      metadata:
        type: string
        description: the REST API URL for the page metadata (not yet active)
      references:
        type: string
        description: the REST API URL for the references on the page (not yet active)
      media:
        type: string
        description: the REST API URL for the media included in the page (not yet active)
      edit_html:
        type: string
        description: the REST API URL for the raw Parsoid HTML for the page
      talk_page_html:
        type: string
        description: the REST API URL for the raw Parsoid HTML for the talk page for this page (if applicable)
    required:
      - summary
#      - read_html
#      - content_html
      - metadata
      - references
      - media
      - edit_html
    additionalProperties: false
